---
title: 类加载机制
categories:
  - Java系统调优
tags:
  - Java
  - JVM
toc: true
date: 2019-06-03 10:53:51
---
## 类生命周期

**1. 加载**:读取二进制内容
**2. 验证**:验证class文件格式规范、语义分析、引用验证、字节码验证
**3. 准备**:分配内存、设置类static修饰的变量初始值
**4. 解析**:类、接口、字段、类方法等解析
**5. 初始化**:为静态变量赋值；执行静态代码块
**6. 使用**:创建实例对象
**7. 卸载**:从JVM方法区中卸载

### 类加载器

类加载器负责装入类,搜索各个位置的类资源.
一个Java程序运行,至少有三个类加载器实例,负责不同类的加载

1. **Bootstrap Loader 核心类库加载器**,由C语言实现,加载JDK核心类库
2. **Extension Class Loader 拓展类库加载器**,加载JDK拓展包
3. **application class loader 用户应用程序加载器**,加载classpath路径下的包

### 类不会重复加载

类的唯一性:同一个类加载器,类名一样,代表同一个类.

#### 双亲委托机制

某一个类加载器想要去加载一个类,并不会立刻去加载,而是委托给父亲,如果父亲上面还有父亲,则继续向上委托,最终到达核心类库加载器,如果核心类库无法记载,再向下一个个委托.
**即,有父类交给父类加载,没父类了开始加载,无法加载向下委托,全都不能加载则失败**

通过双亲委派机制

1. 建立类的层级关系可以避免类的重复加载,当父亲已经加载该类时,就没必要再加载一次了.
2. 优先加载核心类库, 这样防止用户恶意的同名类,因为永远是核心的类先被加载.
